<DIV class="edit_header1" style="margin-bottom:16px">Scans &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" value="Add Scan" onclick="addScan(this)"/>
</DIV>
		  	    
					<TABLE>
					 <thead>
	  <TR>
	  	  <TH align=left></TH>
	  	  <TH align=left>Scan</TH>
	  	  <TH align=left>Type <a onclick="alert('If the required value is not in the list, select MORE to show additional options or CUSTOM to add your own value.');"><img border="0" src="$content.getURI("images/qm.gif")"/></a></TH>
	  	  <TH align=left>Quality</TH>
	  	  <TH align=left>Note</TH>
	  </TR>
	 </thead>
#set ($scanCounter = 0)
 <tbody id="scan_tbody">
 </tbody>
</TABLE>
					<DIV id="scans" style="position: absolute;top:50;left:50;">
</DIV>
<script type="text/javascript" src="$content.getURI("scripts/imageScanData/scan_tools.js")"></script>
<script type="text/javascript">
  function addScan(_button){
    var tempScan = window.classMapping.newInstance("xnat:mrScanData");
    window.scanSet.new_scans.push(tempScan);
    window.scanSet.onLoad.fire();
  }
  
  var options = new Object();
  options.session_id="$!om.getId()";
  
    options.types=new Object();
    options.types["xnat:mrScanData"]=new Object();
    options.types["xnat:mrScanData"].values = new Array();
    options.types["xnat:mrScanData"].uri=serverRoot + "/REST/scan_types?table=xnat_mrScanData";
    options.types["xnat:mrScanData"].containsValue=function(_v){
      for(var tC=0;tC<this.values.length;tC++){
        if(this.values[tC].value==_v){
          return true;
        }		
      }
      return false;
    }
 #set($scanTypes = $data.getSession().getAttribute("user").getQueryResultsAsArrayList("select DISTINCT isd.type from xnat_mrsessiondata mr LEFT JOIN xnat_experimentData expt ON mr.id=expt.id LEFT JOIN xnat_imagescandata isd ON mr.id=isd.image_session_id LEFT JOIN xdat_meta_element xme ON isd.extension=xme.xdat_meta_element_id WHERE expt.project='$project' AND xme.element_name='xnat:mrScanData'"))
   #if($scanTypes.size()>0)
    #foreach($scanT in $scanTypes)
      options.types["xnat:mrScanData"].values.push({"value":"$!scanT.get(0)","display":"$!scanT.get(0)"});
    #end
  #end
  
#if($allowDataDeletion)
   options.allowDataDeletion="$allowDataDeletion";
#else
   options.allowDataDeletion="true";
#end
  
  window.scanSet=new ScanSet(options);
  if(window.classMapping==undefined)window.classMapping=new ClassMapping();
  
	  #set($numScans = $om.getSortedScans().size())
	  #if($numScans>0)
	  #set ($TOP_SCAN = $numScans - 1)
	  #foreach($scani in [0..$TOP_SCAN])
    #set($scan=$om.getSortedScans().get($scani))
    var tempScan = window.classMapping.newInstance("$!scan.getXSIType()");
    tempScan.setProperty("ID","$!turbineUtils.escapeJS($!scan.getId())"); 
    tempScan.setProperty("type","$!turbineUtils.escapeJS($!scan.getType())");
    tempScan.setProperty("quality","$!turbineUtils.escapeJS($!scan.getQuality())");
    tempScan.setProperty("note","$!turbineUtils.escapeJS($!scan.getNote())");
    tempScan.setProperty("series_description","$!turbineUtils.escapeJS($!scan.getSeriesDescription())");
    tempScan.setProperty("parameters/scanTime","$!turbineUtils.escapeJS($!scan.getParameters_scantime())");
		    tempScan.setProperty("parameters/imageType","$!turbineUtils.escapeJS($!scan.getParameters_imagetype())");
		    tempScan.setProperty("parameters/scanSequence","$!turbineUtils.escapeJS($!scan.getParameters_scansequence())");
		    tempScan.setProperty("parameters/seqVariant","$!turbineUtils.escapeJS($!scan.getParameters_seqvariant())");
		    tempScan.setProperty("parameters/scanOptions","$!turbineUtils.escapeJS($!scan.getParameters_scanoptions())");
		    tempScan.setProperty("parameters/acqType","$!turbineUtils.escapeJS($!scan.getParameters_acqtype())");
		    tempScan.setProperty("frames","$!turbineUtils.escapeJS($!scan.getFrames()");
		    tempScan.setProperty("parameters/flip","$!turbineUtils.escapeJS($!scan.getParameters_flip())");
    tempScan.stats="$!scanprops.get($scani).get("files") files, $!scanprops.get($scani).get("size") MB";
    tempScan.setProperty("xnat_imageScanData_id","$!scan.getProperty('xnat_imagescandata_id')");
    window.scanSet.scans.push(tempScan);
    
      if(!options.types["xnat:mrScanData"].containsValue("$!scan.getType()")){
         options.types["xnat:mrScanData"].values.push({"value":"$!scan.getType()","display":"$!scan.getType()"});
      }
   #end
  #end
  
  window.scanSet.onLoad.subscribe(function(obj){
    var listing=new scanListingEditor("scan_tbody",this);
    listing.render();
  });
      
      
  if(window.scanSet.scans.length==0){
    for(var newC=0;newC<5;newC++){
      var tempScan = window.classMapping.newInstance("xnat:mrScanData");
      window.scanSet.new_scans.push(tempScan);
    }
  }
  
      
  window.scanSet.onLoad.fire();
</script>